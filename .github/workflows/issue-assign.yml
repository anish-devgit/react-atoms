name: Issue Assignment

on:
  issue_comment:
    types: [created]

permissions:
  issues: write

jobs:
  assign:
    runs-on: ubuntu-latest
    steps:
      - name: Assign User
        uses: actions/github-script@v7
        with:
          script: |
            const comment = context.payload.comment.body.trim();
            const issue_number = context.issue.number;
            const login = context.payload.comment.user.login;

            if (comment === '.take') {
              const issue = await github.rest.issues.get({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number
              });

              if (issue.data.assignees.length > 0) {
                 await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue_number,
                  body: `@${login} This issue is already assigned to someone else. Please find another issue!`
                });
                return;
              }

              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                assignees: [login]
              });

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                body: `ðŸš€ Released to @${login}! \n\nHappy coding! Please reference this issue in your PR.`
              });
            }
